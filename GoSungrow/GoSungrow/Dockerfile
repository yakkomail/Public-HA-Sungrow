ARG BUILD_FROM
FROM $BUILD_FROM

# FROM alpine:latest
MAINTAINER MickMake <embed@mickmake.com>
USER root

LABEL \
  io.hass.version="VERSION" \
  io.hass.type="addon" \
  io.hass.arch="armhf|aarch64|i386|amd64"


ARG GOSUNGROW_APPKEY
ENV GOSUNGROW_APPKEY ${SUNGROW_APPKEY}
ARG GOSUNGROW_DEBUG
ENV GOSUNGROW_DEBUG ${SUNGROW_DEBUG}
ARG GOSUNGROW_HOST
ENV GOSUNGROW_HOST ${SUNGROW_HOST}
ARG GOSUNGROW_USER
ENV GOSUNGROW_USER ${SUNGROW_USER}
ARG GOSUNGROW_PASSWORD
ENV GOSUNGROW_PASSWORD ${SUNGROW_PASSWORD}
ARG GOSUNGROW_TIMEOUT
ENV GOSUNGROW_TIMEOUT ${SUNGROW_TIMEOUT}

ARG GOSUNGROW_MQTT_HOST
ENV GOSUNGROW_MQTT_HOST ${SUNGROW_MQTT_HOST}
ARG GOSUNGROW_MQTT_PASSWORD
ENV GOSUNGROW_MQTT_PASSWORD ${SUNGROW_MQTT_PASSWORD}
ARG GOSUNGROW_MQTT_PORT
ENV GOSUNGROW_MQTT_PORT ${SUNGROW_MQTT_PORT}
ARG GOSUNGROW_MQTT_USER
ENV GOSUNGROW_MQTT_USER ${SUNGROW_MQTT_USER}

ARG TZ
ENV TZ ${TZ}

COPY src/ /usr/local/bin/
RUN chmod a+x /usr/local/bin/setup.sh && /usr/local/bin/setup.sh

# ENTRYPOINT ["/usr/local/bin/GoSungrow"]
CMD ["/usr/local/bin/run.sh"]

